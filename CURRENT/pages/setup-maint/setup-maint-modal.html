<!-- Modal -->
<div class="modal fade" id="setup-maint-modal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <Span aria-hidden="true">&times;</Span>
        </button>
        <h4 class="modal-title">SETUP MAINTENANCE</h4>
      </div>

      <div class="modal-body">
        <form class="form">
          <!-- Top Row -->
          <div class="row" id="setup-maint-modal-row1-div">
            <!-- CKID -->
            <div class="col-md-4">
              <div class="form-group">
                <label>CKID:</label>
                <label>TN:</label>
                <input id="setup-maint-modal-cbx" type="checkbox" checked />
                <input id="setup-maint-modal-ckid" type="text" class="form-control maint-modal-ckid setup-maint-modal-input" style="display:none;"/>
                <input id="setup-maint-modal-ckid-tn" type="text" class="form-control maint-modal-ckid setup-maint-modal-input" placeholder="555-555-5555"  data-inputmask='"mask": "999-999-9999"' data-mask=""/>
              </div>
            </div>
            <!-- CLS -->
            <div class="col-md-2">
              <div class="form-group">
                <label>CLS:</label>
                <select id="setup-maint-modal-cls" class="form-control setup-maint-modal-input">
                  <option value=""></option>
                  <option value="RES">RES</option>
                  <option value="BUS">BUS</option>
                </select>
              </div>
            </div>
            <!-- ADSR -->
            <div class="col-md-2">
              <div class="form-group">
                <label>ADSR:</label>
                <select id="setup-maint-modal-adsr" class="form-control setup-maint-modal-input">
                  <option value=""></option>
                  <option value="Y">Y</option>
                  <option value="N">N</option>
                </select>
              </div>
            </div>
            <!-- PROT -->
            <div class="col-md-2">
              <div class="form-group">
                <label>PROT:</label>
                <select id="setup-maint-modal-prot" class="form-control setup-maint-modal-input">
                  <option value=""></option>
                  <option value="SSM">SSM</option>
                  <option value="SSB">SSB</option>
                </select>
              </div>
            </div>
          </div>
          <!-- Row 2 -->
          <div class="row" id="setup-maint-modal-row2-div">
            <!-- TKTNO -->
            <div class="col-md-4">
              <div class="form-group">
                <label>TKTNO</label>
                <input id="setup-maint-modal-tktno" type="text" class="form-control setup-maint-modal-input" />
              </div>
            </div>
            <!-- MLO -->
            <div class="col-md-2">
              <div class="form-group">
                <label>MLO:</label>
                <select id="setup-maint-modal-mlo" class="form-control setup-maint-modal-input">
                  <option value=""></option>
                  <option value="N">N</option>
                  <option value="Y">Y</option>
                </select>
              </div>
            </div>
          </div>
          <!-- Row 3 -->
          <div class="row" id="setup-maint-modal-row3-div">
            <!-- CONTYP -->
            <div class="col-md-2">
              <div class="form-group">
                <label>CONTYP:</label>
                <select id="setup-maint-modal-contyp" class="form-control setup-maint-modal-input">
                  <option value=""></option>
                  <option value="GEN">GEN</option>
                  <option value="LPBK">LPBK</option>
                  <option value="MLPT">MLPT</option>
                </select>
              </div>
            </div>
            <!-- FAC(X) -->
            <div class="col-md-5">
              <div class="form-group">
                <label>FAC(X):</label>
                <input id="setup-maint-modal-ffac" type="text" class="form-control setup-maint-modal-input">
              </div>
            </div>
            <!-- FAC(Y) -->
            <div class="col-md-5">
              <div class="form-group">
                <label>FAC(Y):</label>
                <input id="setup-maint-modal-tfac" type="text" class="form-control setup-maint-modal-input">
              </div>
            </div>
          </div>
          <!-- MTC Test Div -->
          <div id="setup-maint-modal-mtctest-div" style="display:none;">
            <!-- Radio 1 -->
            <div class="col-md-1">
              <div class="form-group">
                <input id="setup-maint-modal-test-radio1" type="radio" class="pull-right" name="select-test-port1" style="margin-top:35px;" />
              </div>
            </div>
            <!-- CTYP -->
            <div class="col-md-3">
              <div class="form-group">
                <label>CTYP:</label>
                <input id="setup-maint-modal-test-ctyp1" type="text" class="form-control setup-maint-modal-input" disabled="" />
              </div>
            </div>
            <!-- FAC(X) -->
            <div class="col-md-4">
              <div class="form-group">
                <label>FAC(X):</label>
                <input id="setup-maint-modal-test-ffac" type="text" class="form-control setup-maint-modal-input" disabled="" />
              </div>
            </div>
            <!-- TEST PORT -->
            <div class="col-md-4">
              <div class="form-group">
                <label>TEST PORT</label>
                <select id="setup-maint-modal-test-port1" class="form-control setup-maint-modal-input">
                </select>
              </div>
            </div>
            <!-- Radio 2 -->
            <div class="col-md-1">
                <div class="form-group">
                  <input id="setup-maint-modal-test-radio2" type="radio" class="pull-right" name="select-test-port2" style="margin-top:35px;" />
                </div>
              </div>
              <!-- CTYP -->
              <div class="col-md-3">
                <div class="form-group">
                  <label>CTYP:</label>
                  <input id="setup-maint-modal-test-ctyp2" type="text" class="form-control setup-maint-modal-input" disabled="" />
                </div>
              </div>
              <!-- FAC(Y) -->
              <div class="col-md-4">
                <div class="form-group">
                  <label>FAC(Y):</label>
                  <input id="setup-maint-modal-test-tfac" type="text" class="form-control setup-maint-modal-input" disabled="" />
                </div>
              </div>
              <!-- TEST PORT -->
              <div class="col-md-4">
                <div class="form-group">
                  <label>TEST PORT</label>
                  <select id="setup-maint-modal-test-port2" class="form-control setup-maint-modal-input">
                  </select>
                </div>
              </div>
          </div>
          <!-- MTC Connect Row 3 -->
          <div class="row" id="setup-maint-modal-mtccon1-div" style="display:none;">
            <!-- RADIO -->
            <div class="col-md-1">
              <div class="form-group">
                <input id="setup-maint-modal-pick-conn1" type="radio" class="pull-right" name="select-test-fac" style="margin-top:35px;">
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label>CTYP:</label>
                <input id="setup-maint-modal-conn1-ctyp" type="text" class="form-control setup-maint-modal-input" disabled="" />
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label>FAC(X)</label>
                <input id="setup-maint-modal-conn1-ffac" type="text" class="form-control setup-maint-modal-input" disabled="" />
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label>FAC(Y)</label>
                <select id="setup-maint-modal-conn1-tfac" class="form-control setup-maint-modal-input">
                </select>
              </div>
            </div>
          </div>
          <!-- MTC Connect Row 4 -->
          <div class="row" id="setup-maint-modal-mtccon2-div" style="display:none;">
            <!-- RADIO -->
            <div class="col-md-1">
              <div class="form-group">
                <input id="setup-maint-modal-pick-conn2" type="radio" class="pull-right" name="select-test-fac" style="margin-top:35px;">
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label>CTYP:</label>
                <input id="setup-maint-modal-conn2-ctyp" type="text" class="form-control setup-maint-modal-input" disabled="" />
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label>FAC(Y)</label>
                <input id="setup-maint-modal-conn2-tfac" type="text" class="form-control setup-maint-modal-input" disabled="" />
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label>FAC(X)</label>
                <select id="setup-maint-modal-conn2-ffac" class="form-control setup-maint-modal-input">
                </select>
              </div>
            </div>
          </div>
          <!-- Row 4 -->
          <div class="row" id="setup-maint-modal-row4-div">
            <!-- DD -->
            <div class="col-md-6">
              <div class="form-group">
                <label>DD:</label>
                <div class="input-group date">
                  <div class="input-group-addon">
                    <i class="fa fa-calendar"></i>
                  </div>
                  <input id="setup-maint-modal-dd" type="text" class="form-control pull-right setup-maint-modal-input" />
                </div>
              </div>
            </div>
            <!-- FDD -->
            <div class="col-md-6">
              <div class="form-group">
                <label>FDD:</label>
                <div class="input-group date">
                  <div class="input-group-addon">
                    <i class="fa fa-calendar"></i>
                  </div>
                  <input id="setup-maint-modal-fdd" type="text" class="form-control pull-right setup-maint-modal-input" />
                </div>
              </div>
            </div>
          </div>
          <!-- Action Row -->
          <div class="row" id="setup-maint-modal-row5-div">
            <div class="col-md-4">
              <div class="form-group">
                <label>ACTION:</label>
                <input id="setup-maint-modal-action" type="text" class="form-control setup-maint-modal-input" disabled=""/>
              </div>
            </div>
          </div>
          <!-- Footer -->
          <div class="modal-footer">
            <button type="button" class="btn btn-default pull-left" data-dismiss="modal">
              Close
            </button>
            <button id="setup-maint-modal-submit" type="button" class="btn btn-primary">
              Submit
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  var maintPickedTfac = "";
  var maintPickedFfac = "";
  var maintPstaTfac = "";
  var maintPstaFfac = "";

  function validateMtcConnModal(obj, ckid) {
    if ($('#setup-maint-modal-pick-conn1').is(':checked')) {
      maintPickedTfac = $('#setup-maint-modal-conn1-tfac').val();
      maintPickedFfac = $('#setup-maint-modal-conn1-ffac').val();
      if (maintPickedTfac == "") {
        inputError($('#setup-maint-modal-conn1-tfac'),'Missing FAC(Y)');
        return;
      }
      if (maintPickedFfac == "")  {
        inputError($('#setup-maint-modal-conn1-ffac'),'Missing FAC(X)');
        return;
      }
    }
    else if ($('#setup-maint-modal-pick-conn2').is(':checked')) {
      maintPickedTfac = $('#setup-maint-modal-conn2-tfac').val();
      maintPickedFfac = $('#setup-maint-modal-conn2-ffac').val();
      if (maintPickedTfac == "") {
        inputError($('#setup-maint-modal-conn2-tfac'),'Missing FAC(Y)');
        return;
      }
      if (maintPickedFfac == "")  {
        inputError($('#setup-maint-modal-conn2-ffac'),'Missing FAC(X)');
        return;
      }
    }

    $.ajax({
      type:       'POST',
      url:        ipcDispatch,
      data:       {
        "api":    "ipcMaintConnect",
        "act":      obj.action,
        "user":     user.uname,
        "ckid":     ckid,
        "cls":      obj.cls,
        "adsr":     obj.adsr,
        "prot":     obj.prot,
        "tktno":    obj.tktno,
        "mlo":      obj.mlo,
        "ctyp":     obj.ctyp,
        "ffac":     maintPickedFfac,
        "tfac":     maintPickedTfac,
      },
      dataType:     'json'
    }).done(function(data) {
      let res = data.rows;
      let modal = {
        header:   data.rslt,
        body:     data.reason,
      }

      if (data.rslt == 'fail') {
        modal.type = 'danger';
        modalHandler(modal);
      }
      else {
        modal.type = 'success';
        modalHandler(modal);
      }
    })

  }

  function validateMtcDisconModal(obj, ckid) {
    if (obj.ffac == "") {
      inputError($('#setup-maint-modal-ffac'),'Missing FAC(X)');
      return;
    }
    if (obj.tfac == "") {
      inputError($('#setup-maint-modal-tfac'),'Missing FAC(Y)');
      return;
    }

    $.ajax ({
      type:       'POST',
      url:        ipcDispatch,
      data:       {
        "api":    "ipcMaintDiscon",
        "act":    "MTC_DISCON",
        "user":   user.uname,
        "ckid":   ckid,
        "cls":    obj.cls,
        "adsr":   obj.adsr,
        "prot":   obj.prot,
        "tktno":  obj.tktno,
        "mlo":    obj.mlo,
        "ctyp":   obj.ctyp,
        "ffac":   obj.ffac,
        "tfac":   obj.tfac,
      },
      dataType:   'json',
    }).done(function(data) {
      let res = data.rows;
      let modal = {
        header:   data.rslt,
        body:     data.reason,
      }

      if (data.rslt == 'fail') {
        modal.type = 'danger';
        modalHandler(modal);
      }
      else {
        modal.type = 'success';
        modalHandler(modal);
      }
    })
  }

  function validateRestoreMtcdModal(obj, ckid) {
    if (obj.ffac == "") {
      inputError($('#setup-maint-modal-ffac'),'Missing FAC(X)');
      return;
    }
    if (obj.tfac == "") {
      inputError($('#setup-maint-modal-tfac'),'Missing FAC(Y)');
      return;
    }

    $.ajax ({
      type:       'POST',
      url:        ipcDispatch,
      data:       {
        "api":    "ipcMaintRestoreMtcd",
        "act":    "RESTORE_MTCD",
        "user":   user.uname,
        "ckid":   ckid,
        "cls":    obj.cls,
        "adsr":   obj.adsr,
        "prot":   obj.prot,
        "tktno":  obj.tktno,
        "mlo":    obj.mlo,
        "ctyp":   obj.ctyp,
        "ffac":   obj.ffac,
        "tfac":   obj.tfac,
      },
      dataType:   'json',
    }).done(function(data) {
      let res = data.rows;
      let modal = {
        header:   data.rslt,
        body:     data.reason,
      }

      if (data.rslt == 'fail') {
        modal.type = 'danger';
        modalHandler(modal);
      }
      else {
        modal.type = 'success';
        modalHandler(modal);
      }
    })
  }

  function validateMtcRestoreModal(obj, ckid) {
    if (obj.ffac == "") {
      inputError($('#setup-maint-modal-ffac'),'Missing FAC(X)');
      return;
    }
    if (obj.tfac == "") {
      inputError($('#setup-maint-modal-tfac'),'Missing FAC(Y)');
      return;
    }

    $.ajax ({
      type:       'POST',
      url:        ipcDispatch,
      data:       {
        "api":    "ipcMaintConnect",
        "act":    "MTC_RESTORE",
        "user":   user.uname,
        "ckid":   ckid,
        "cls":    obj.cls,
        "adsr":   obj.adsr,
        "prot":   obj.prot,
        "tktno":  obj.tktno,
        "mlo":    obj.mlo,
        "ctyp":   obj.ctyp,
        "ffac":   obj.ffac,
        "tfac":   obj.tfac,
      },
      dataType:   'json',
    }).done(function(data) {
      let res = data.rows;
      let modal = {
        header:   data.rslt,
        body:     data.reason,
      }

      if (data.rslt == 'fail') {
        modal.type = 'danger';
        modalHandler(modal);
      }
      else {
        modal.type = 'success';
        modalHandler(modal);
      }
    })
  }
  $(document).ready(function() {

    $('#setup-maint-modal-submit').click(function() {

      let obj = {
        cls:    $('#setup-maint-modal-cls').val(),
        adsr:   $('#setup-maint-modal-adsr').val(),
        prot:   $('#setup-maint-modal-prot').val(),
        tktno:  $('#setup-maint-modal-tktno').val(),
        mlo:    $('#setup-maint-modal-mlo').val(),
        dd:     $('#setup-maint-modal-dd').val(),
        fdd:    $('#setup-maint-modal-fdd').val(),
        action: $('#setup-maint-modal-action').val(),
        ctyp:   $('#setup-maint-modal-contyp').val(),
        ffac:   $('#setup-maint-modal-ffac').val(),
        tfac:   $('#setup-maint-modal-tfac').val()
      }

      let ckid = "";
      if ($('#setup-maint-modal-cbx').prop('checked')) {
        ckid = $('#setup-maint-modal-ckid-tn').val();
      }
      else {
        ckid = $('#setup-maint-modal-ckid').val();
      }


      if (obj.action == "MTC_CONN") {
        validateMtcConnModal(obj, ckid);
      }
      else if (obj.action == "MTC_DISCON") {
        validateMtcDisconModal(obj, ckid);
      }
      else if (obj.action == "RESTORE_MTCD") {
        validateRestoreMtcdModal(obj, ckid);
      }
      else if (obj.action == "MTC_RESTORE") {
        validateMtcRestoreModal(obj, ckid);
      }
      else if (obj.action == "MTC_TEST"){

      }
      else if (obj.action == "CHANGE") {

      }
    })

    // Radio Button Click Event for Action MTC_CONN Top Button
    $('#setup-maint-modal-pick-conn1').click(function() {
      clearErrors();

      if ($('#setup-maint-modal-pick-conn1').is(':checked')) {
        $('#setup-maint-modal-conn1-tfac').prop('disabled',false);
        $('#setup-maint-modal-conn2-ffac').prop('disabled',true);
      }
    });
    // Radio Button Click Event for Action MTC_CONN Bottom Button
    $('#setup-maint-modal-pick-conn2').click(function() {
      clearErrors();

      if ($('#setup-maint-modal-pick-conn2').is(':checked')) {
        $('#setup-maint-modal-conn1-tfac').prop('disabled',true);
        $('#setup-maint-modal-conn2-ffac').prop('disabled',false);
      }
    })
    // Initialize Datepicker
    $('#setup-maint-modal-dd').datepicker();
    $('#setup-maint-modal-fdd').datepicker();


    // Initialize inputmask
    $('#setup-maint-modal-ckid-tn').inputmask();

    // TN Checkbox Handler
    $('#setup-maint-modal-cbx').iCheck({
      checkboxClass: 'icheckbox_minimal-blue'
    });
    $('#setup-maint-modal-cbx').on('ifToggled', function(){
      $('.maint-modal-ckid').toggle();
    });

  })
</script>