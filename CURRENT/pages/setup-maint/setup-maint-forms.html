<!-- Forms -->
<div class="col-md-5">
  <form id="setup-maint-forms">
    <!-- Top Row -->
    <div class="row">
      <!-- CKID -->
      <div class="col-md-4">
        <div class="form-group">
          <label>CKID:</label>
          <label>TN:</label>
          <input id="setup-maint-forms-cbx" type="checkbox" checked />
          <input id="setup-maint-forms-ckid" type="text" class="form-control maint-ckid setup-maint-forms-input" style="display:none;"/>
          <input id="setup-maint-forms-ckid-tn" type="text" class="form-control maint-ckid setup-maint-forms-input" placeholder="555-555-5555"  data-inputmask='"mask": "999-999-9999"' data-mask=""/>
        </div>
      </div>
      <!-- CLS -->
      <div class="col-md-3">
        <div class="form-group">
          <label>CLS:</label>
          <select id="setup-maint-forms-cls" class="form-control setup-maint-forms-input">
            <option value=""></option>
            <option value="RES">RES</option>
            <option value="BUS">BUS</option>
          </select>
        </div>
      </div>
      <!-- ADSR -->
      <div class="col-md-3">
        <div class="form-group">
          <label>ADSR:</label>
          <select id="setup-maint-forms-adsr" class="form-control">
            <option value=""></option>
            <option value="Y">Y</option>
            <option value="N">N</option>
          </select>
        </div>
      </div>
      <!-- View Button -->
      <div class="col-md-2">
        <div class="form-group">
          <button id="setup-maint-forms-viewckid" type="button" class="btn btn-primary btn-flat" style="margin-top:25px">
            View
          </button>
        </div>
      </div>
    </div>
    <!-- Row 2 -->
    <div class="row">
      <!-- TKTNO -->
      <div class="col-md-4">
        <div class="form-group">
          <label>TKTNO</label>
          <input id="setup-maint-forms-tktno" type="text" class="form-control setup-maint-forms-input">
        </div>
      </div>
      <!-- MLO -->
      <div class="col-md-3">
        <div class="form-group">
          <label>MLO</label>
          <select id="setup-maint-forms-mlo" class="form-control setup-maint-forms-input">
            <option value=""></option>
            <option value="N" selected="selected">N</option>
            <option value="Y">Y</option>
          </select>
        </div>
      </div>
      <!-- PROT -->
      <div class="col-md-3">
        <div class="form-group">
          <label>PROT:</label>
          <select id="setup-maint-forms-prot" class="form-control setup-maint-forms-input">
            <option value=""></option>
            <option value="SSM">SSM</option>
            <option value="SSP">SSP</option>
          </select>
        </div>
      </div>
      <!-- View Button -->
      <div class="col-md-2">
        <div class="form-group">
          <button id="setup-maint-forms-viewtkt" type="button" class="btn btn-primary btn-flat" style="margin-top:25px;">
            View
          </button>
        </div>
      </div>
    </div>
    <!-- Row 3 -->
    <div class="row">
      <!-- DD -->
      <div class="col-md-6">
        <div class="form-group">
          <label>DD:</label>
          <div class="input-group date">
            <div class="input-group-addon">
              <i class="fa fa-calendar"></i>
            </div>
            <input id="setup-maint-forms-dd" type="text" class="form-control pull-right">
          </div>
        </div>
      </div>
      <!-- FDD -->
      <div class="col-md-6">
          <div class="form-group">
            <label>FDD:</label>
            <div class="input-group date">
              <div class="input-group-addon">
                <i class="fa fa-calendar"></i>
              </div>
              <input id="setup-maint-forms-fdd" type="text" class="form-control pull-right">
            </div>
          </div>
        </div>
      </div>
      <!-- Row 4 -->
      <div class="row">
        <!-- CONTYP -->
        <div class="col-md-2">
          <div class="form-group">
            <label>CONTYP</label>
            <select id="setup-maint-forms-contyp" class="form-control">
              <option value=""></option>
              <option value="GEN">GEN</option>
              <option value="LPBK">LPBK</option>
              <option value="MLPT">MLPT</option>
            </select>
          </div>
        </div>
        <!-- FAC(X) -->
        <div class="col-md-5">
          <div class="col-md-12">
            <div class="form-group">
              <label>FAC(X):</label>
              <a id="setup-maint-forms-searchx" class="pull-right">Search</a>
              <input id="setup-maint-forms-ffac" type="text" class="form-control setup-maint-forms-input" />
            </div>
          </div>
          <!-- PORT(X) -->
          <div class="col-md-3">
            <div class="form-group">
              <label>PORT(X):</label>
            </div>
          </div>
          <div class="col-md-9">
            <div class="form-group">
              <input id="setup-maint-forms-fport" type="text" class="form-control setup-maint-forms-input" />
            </div>
          </div>
        </div>
        <!-- FAC(Y) -->
        <div class="col-md-5">
          <div class="col-md-12">
            <div class="form-group">
              <label>FAC(Y):</label>
              <a id="setup-maint-forms-searchy" class="pull-right">Search</a>
              <input id="setup-maint-forms-tfac" type="text" class="form-control setup-maint-forms-input" />
            </div>
          </div>
          <!-- PORT(Y) -->
          <div class="col-md-3">
            <div class="form-group">
              <label>PORT(Y):</label>
            </div>
          </div>
          <div class="col-md-9">
            <div class="form-group">
              <input id="setup-maint-forms-tport" type="text" class="form-control setup-maint-forms-input" />
            </div>
          </div>
        </div>
      </div>
      <!-- Hidden Row -->
      <div class="row" id="setup-maint-forms-factable-div" style="display:none;">
        <!-- Search Table -->
        <div class="col-md-12">
          <div class="box box-primary">
            <div class="body">
              <table id="setup-maint-forms-factable" class="table table-striped table-bordered table-hover" style="width:100%">
                <thead>
                  <tr>
                    <th>FAC</th>
                    <th>PSTA</th>
                    <th>PORT</th>
                  </tr>
                </thead>
              </table>
            </div>
          </div>
        </div>
      </div>
      <!-- ACTION Row -->
      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label>ACTION</label>
            <select id="setup-maint-forms-action" class="form-control setup-maint-forms-input">
              <option value=""></option>
              <option value="MTC_DISCON">MTC_DISCON</option>
              <option value="MTC_CONN">MTC_CONN</option>
              <option value="MTC_RESTORE">MTC_RESTORE</option>
              <option value="RESTORE_MTCD">RESTORE_MTCD</option>
              <option value="MTC_TEST">MTC_TEST</option>
              <option value="CHANGE">CHANGE</option>
            </select>
          </div>
        </div>
        <div class="col-md-2">
          <div class="form group">
            <button id="setup-maint-forms-clear" type="button" class="btn btn-primary btn-flat" style="margin-top:25px">
              Clear
            </button>
          </div>
        </div>
      </div>

  </form>
</div>
<script type="text/javascript">

  function validateRestoreMtcd(obj, ckid) {

    $('#setup-maint-modal-mtccon1-div').hide();
    $('#setup-maint-modal-mtccon2-div').hide();
    
    if (maintTableCktsId == "" || maintTableCktsId == 0) {
      inputError($('#setup-maint-forms-action'),'Select from the list of CKTs');
      $('#setup-maint-forms-action').val('');
      return;
    } 
    else if (maintTableConsId == "" || maintTableConsId == 0) {
      inputError($('#setup-maint-forms-action'),'Select from the list of Connections');
      $('#setup-maint-forms-action').val('');
      return;
    }
    else {
      $('#setup-maint-modal-ckid').val(ckid);
      $('#setup-maint-modal-cls').val(obj.cls);
      $('#setup-maint-modal-adsr').val(obj.adsr);
      $('#setup-maint-modal-prot').val(obj.prot);
      $('#setup-maint-modal-tktno').val(obj.tktno);
      $('#setup-maint-modal-mlo').val(obj.mlo);
      $('#setup-maint-modal-contyp').val(obj.contyp);
      $('#setup-maint-modal-ffac').val(obj.ffac);
      $('#setup-maint-modal-tfac').val(obj.tfac);
      $('#setup-maint-modal-action').val(obj.action);
      
      $('#setup-maint-modal').modal('show');
    }
  }

  function validateMtcRestore(obj, ckid) {

    $('#setup-maint-modal-mtccon1-div').hide();
    $('#setup-maint-modal-mtccon2-div').hide();

    if (maintTableCktsId == "" || maintTableCktsId == 0) {
      inputError($('#setup-maint-forms-action'),'Select from the list of CKTs');
      $('#setup-maint-forms-action').val('');
      return;
    } 
    else if (maintTableConsId == "" || maintTableConsId == 0) {
      inputError($('#setup-maint-forms-action'),'Select from the list of Connections');
      $('#setup-maint-forms-action').val('');
      return;
    }
    else {
      $('#setup-maint-modal-ckid').val(ckid);
      $('#setup-maint-modal-cls').val(obj.cls);
      $('#setup-maint-modal-adsr').val(obj.adsr);
      $('#setup-maint-modal-prot').val(obj.prot);
      $('#setup-maint-modal-tktno').val(obj.tktno);
      $('#setup-maint-modal-mlo').val(obj.mlo);
      $('#setup-maint-modal-contyp').val(obj.contyp);
      $('#setup-maint-modal-ffac').val(obj.ffac);
      $('#setup-maint-modal-tfac').val(obj.tfac);
      $('#setup-maint-modal-action').val(obj.action);
      
      $('#setup-maint-modal').modal('show');
    }
  }

  function validateMtcDisconnect(obj, ckid) {

    if (maintTableCktsId == "" || maintTableCktsId == 0) {
      inputError($('#setup-maint-forms-action'),'Select from the list of CKTs');
      $('#setup-maint-forms-action').val('');
      return;
    } 
    else if (maintTableConsId == "" || maintTableConsId == 0) {
      inputError($('#setup-maint-forms-action'),'Select from the list of Connections');
      $('#setup-maint-forms-action').val('');
      return;
    }
    else {
    
    $('#setup-maint-modal-mtccon1-div').hide();
    $('#setup-maint-modal-mtccon2-div').hide();
    
    $('#setup-maint-modal-ckid').prop('disabled',true);
    $('#setup-maint-modal-ckid-tn').prop('disabled',true);
    $('#setup-maint-modal-cls').prop('disabled',true);
    $('#setup-maint-modal-adsr').prop('disabled',true);
    $('#setup-maint-modal-prot').prop('disabled',true);
    $('#setup-maint-modal-tktno').prop('disabled',false);
    $('#setup-maint-modal-mlo').prop('disabled',true);
    $('#setup-maint-modal-contyp').prop('disabled',true);
    $('#setup-maint-modal-ffac').prop('disabled',true);
    $('#setup-maint-modal-tfac').prop('disabled',true);
    $('#setup-maint-modal-ckid').prop('disabled',true);
    $('#setup-maint-modal-action').prop('disabled',true);

    $('#setup-maint-modal-ckid').val(ckid);
    $('#setup-maint-modal-cls').val(obj.cls);
    $('#setup-maint-modal-adsr').val(obj.adsr);
    $('#setup-maint-modal-prot').val(obj.prot);
    $('#setup-maint-modal-tktno').val(obj.tktno);
    $('#setup-maint-modal-mlo').val(obj.mlo);
    $('#setup-maint-modal-contyp').val(obj.contyp);
    $('#setup-maint-modal-ffac').val(obj.ffac);
    $('#setup-maint-modal-tfac').val(obj.tfac);
    $('#setup-maint-modal-action').val(obj.action);
    
    $('#setup-maint-modal').modal('show');
    }
  }
  // Initialize Hidden Fac Datatable
  var setupMaintFacTable = $('#setup-maint-forms-factable').DataTable({
    "dom":"frtip",
    "scrollY":"150px",
    "data":[],
    "columns": [
      {"data":"fac"},
      {"data":"psta"},
      {"data":"port"},
    ]
  })

  $(document).ready(function() {

    // Initialize DatePicker
    $('#setup-maint-forms-dd').datepicker();
    $('#setup-maint-forms-fdd').datepicker();

    // Action Change Event
    $('#setup-maint-forms-action').change(function() {
      $('.setup-maint-modal-input').val('');
      clearErrors();
      
      let obj = {
        action:     $('#setup-maint-forms-action').val(),
        // ckid:     $('#setup-maint-forms-ckid').val(),
        cls:        $('#setup-maint-forms-cls').val(),
        adsr:       $('#setup-maint-forms-adsr').val(),
        tktno:      $('#setup-maint-forms-tktno').val(),
        mlo:        $('#setup-maint-forms-mlo').val(),
        prot:       $('#setup-maint-forms-prot').val(),
        ckid:       $('#setup-maint-forms-ckid').val(),
        dd:         $('#setup-maint-forms-dd').val(),
        fdd:        $('#setup-maint-forms-fdd').val(),
        contyp:     $('#setup-maint-forms-contyp').val(),
        ckid:       $('#setup-maint-forms-ckid').val(),
        ffac:       $('#setup-maint-forms-ffac').val(),
        tfac:       $('#setup-maint-forms-tfac').val(),
        fport:      $('#setup-maint-forms-fport').val(),
        tport:      $('#setup-maint-forms-tport').val(),
      }

      let ckid = "";
      if ($('#setup-maint-forms-cbx').prop('checked')) {
        ckid = $('#setup-maint-forms-ckid-tn').val();
      }
      else {
        ckid = $('#setup-maint-forms-ckid').val();
      }

      if (obj.action == "MTC_DISCON") {
        validateMtcDisconnect(obj, ckid);
      } else if (obj.action == "MTC_CONN") {

      } else if (obj.action == "MTC_RESTORE") {
        validateMtcRestore(obj, ckid);
      } else if (obj.action == "RESTORE_MTCD") {
        validateRestoreMtcd(obj, ckid);
      } else if (obj.action == "MTC_TEST") {
        
      } else if (obj.action == "CHANGE") {

      }

    })

    // View Button 1
    $('#setup-maint-forms-viewckid').click(function() {

      $('#setup-maint-table-ckts-div').show();
      $('#setup-maint-table-tkts-div').hide();

      clearErrors();

      let ckid = "";
      if ($('#setup-maint-forms-cbx').prop('checked')) {
        ckid = $('#setup-maint-forms-ckid-tn').val();
      }
      else {
        ckid = $('#setup-maint-forms-ckid').val();
      }

      $.ajax ({
        type:     'POST',
        url:      ipcDispatch,
        data:     {
          "api":    "ipcProv",
          "act":    "queryCkid",
          "user":   user.uname,
          "ckid":   ckid
        },
        dataType:   'json'
      }).done(function(data) {
        let res = data.rows;
        let modal = {
          header: data.rslt,
          body:   data.reason,
        }

        if (res.length == 0) {
          inputError($('#setup-maint-forms-ckid'),'No Results Found');
        }

        if (data.rslt == 'fail') {
          modal.type = 'danger';
          modalHandler(modal);
        }
        else {
          setupMaintTableCkts.clear().draw();
          setupMaintTableCkts.rows.add(res);
          setupMaintTableCkts.columns.adjust().draw();
        }

        
      })
    })
    
    // View Button 2
    $('#setup-maint-forms-viewtkt').click(function() {
      $('#setup-maint-table-ckts-div').hide();
      $('#setup-maint-table-tkts-div').show();

      clearErrors();

      let tktno = $('#setup-maint-forms-tktno').val();

      $.ajax ({
        type:     'POST',
        url:      ipcDispatch,
        data:     {
          "api":    "ipcMaintReport",
          "act":    "queryTkt",
          "user":   user.uname,
          "tktno":  tktno
        },
        dataType:   'json',
      }).done(function(data) {
        let res = data.rows;
        let modal = {
          header:   data.rslt,
          body:     data.reason,
        }

        if (res.length == 0) {
          inputError($('#setup-maint-forms-tktno'),'No Results Found');
        }

        if (data.rslt == 'fail') {
          modal.type = 'danger';
          modalHandler(modal);
        }
        else {
          setupMaintTableTkts.clear().draw();
          setupMaintTableTkts.rows.add(res);
          setupMaintTableTkts.columns.adjust().draw();
        }
      })
    })
    
    // Initialize inputmask
    $('#setup-maint-forms-ckid-tn').inputmask();

    // TN Checkbox Handler
    $('#setup-maint-forms-cbx').iCheck({
      checkboxClass: 'icheckbox_minimal-blue'
    });
    $('#setup-maint-forms-cbx').on('ifToggled', function(){
      $('.maint-ckid').toggle();
    });

  })
</script>