<div class="row sysview-actions-row">
  <div class="col-md-12">
    <button id="find-ckid-btn" type="button" class="btn btn-default">Find CKID</button>
  </div>
</div>

<div class="modal fade" id="ckid-modal">
  <div class="modal-dialog modal-lg" style="transition: width 0.7s;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Find CKID</h4>
      </div>
      <div class="modal-body">
        <div class="row" style="margin-bottom: 10px;">
          <div id="ckid-input" class="form-group col-md-4">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="555-555-5555"/>
              <span class="input-group-btn">
                <button id="find-ckid-submit" type="button" class="btn btn-primary btn-flat">Find</button>
              </span>
            </div>
            <span class="help-block"></span>
          </div>
        </div>
        <!-- <form>
          <div id="ckid-input" class="form-group">
            <label>CKID Number</label>
            <input type="text" class="form-control" placeholder="555-555-5555"/>
            <span class="help-block"></span>
          </div>
        </form> -->
        <table id="ckid-table" class="table" style="width:100%;">
          <thead>
            <tr>
              <th rowspan="2">CONTYP</th>
              <th colspan="3">FROM(X):</th>
              <th colspan="3">TO(Y):</th>
            </tr>
            <tr>
              <th>PORT</th>
              <th>PSTA</th>
              <th>FAC(X)</th>
              <th>PORT</th>
              <th>PSTA</th>
              <th>FAC(Y)</th>
            </tr>
          </thead>
        </table>
        
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Confirm</button>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>

<script type="text/javascript">

  $(document).ready(function() {

    // Initialize datatable
    var datatable = $('#ckid-table').DataTable({
      "data": [],
      // "ajax": {
      //   "type": "POST",
      //   "url": ipcDispatch,
      //   "data": {
      //     "api":    "ipcProv",
      //     "act":    "queryCktconByCkid",
      //     "user":   'SYSTEM',
      //     "ckid":   '555-555-5555'
      //   },
      //   "dataType": 'json',
      //   "dataSrc": 'rows',
      // },
      "columns": [
        {"data":"ctyp"},
        {"data":"fport"},
        {"data":"fpsta"},
        {"data":"ffac"},
        {"data":"tport"},
        {"data":"tpsta"},
        {"data":"tfac"},
      ]
    });


    // Functions
    function queryCkid(ckid) {
      $.ajax({
        type: 'POST',
        url: ipcDispatch,
        data: {
          "api":      "ipcProv",
          "act":      "queryCktconByCkid",
          "user":     user.user,
          "ckid":     ckid
        },
        dataType: 'json'
      }).done(function(data) {
        let res = data.rows;
        console.log(res);
        
        datatable.clear().draw();
        console.log('after clear');
        datatable.rows.add(res); // Add new data
        console.log('after row add');
        datatable.columns.adjust().draw(); // Redraw the DataTable
        console.log('after adjust');
      });
    }
    

    // Click Events
    $(document).on('click', '#find-ckid-btn', function() {
      $('#ckid-modal').modal('toggle');
    });

    $(document).on('click', '#find-ckid-submit', function() {
      let ckid = $('#ckid-input input').val();
      if ( !ckid ) {
        $('#ckid-input .help-block').text('Missing value for CKID');
        $('#ckid-input').addClass('has-error');
      } else {
        queryCkid(ckid);
      }
    });
  });
</script>