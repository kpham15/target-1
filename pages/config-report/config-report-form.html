<!-- FORM -->
<div class="col-md-12">
    <form id="configReport-form">
      <!-- ROW 1 BEGIN-->
      <div class="row">
  
        <!-- USER -->
        <div class="col-md-1">
          <label>USER</label>
          <input id="configReport-form-user" class="form-control configReport-form-input">
        </div>
  
        <!-- ACTION -->
        <div class="col-md-2">
          <label>ACTION</label>
          <select class="form-control configReport-form" id="configReport-form-action">
            <option></option>
            <!-- POPULATED BASED ON TYPE -->

          </select>
        </div>
  
        <!-- DateRangePicker -->
        <div class="col-md-4">
          <div class="form-group">
            <label>DATE RANGE:</label>
            <div class="input-group">
                <div class="input-group-addon">
                  <i class="fa fa-calendar"></i>
                </div>
                <input type="text" id="configReport-form-daterange" class="form-control pull-right">
            </div>
          </div>
        </div>
        
      </div>
      <!-- END ROW 1 -->
  
      <!-- ROW 2 BEGIN -->
      <div class="row">
  
        <!-- REPORT -->
        <div class="col-md-3">
          <div class="form-group">
            <label>REPORT:</label>
            <select id="configReport-form-report" class="form-control configReport-form-input">
              <option value=""></option>
              <option value="VIEW REPORT">VIEW REPORT</option>
              <option value="CREATE REPORT">CREATE REPORT</option>
            </select>
          </div>
        </div>

        <!-- REPORT -->
        <div class="col-md-4">
          <div class="form-group">
            <label>TYPE:</label>
            <select id="configReport-form-type" class="form-control configReport-form-input">
              <option value=""></option>
              <option>SETUP PORT MAPPING</option>
              <option>SETUP FACILITIES</option>
              <option>SETUP WIRE CENTER</option>
            </select>
          </div>
        </div>
  
        <!-- Submit Button -->
        <button id="configReport-form-submit" type="button" class="btn btn-primary" style="margin-top:25px">
          Submit
        </button>
        
        <!-- Clear Button -->
        <button id="configReport-form-clear" type="button" class="btn btn-primary" style="margin-top:25px">
          Clear
        </button>
  
      </div>
      <!-- ROW 2 END -->
      
    </form>
  </div>
  
  <script type="text/javascript">
  
    // DOWNLOAD REPORT
    function downloadConfigReports(args) {
      var data, filename, link;
      var csv = convertArrayOfObjectsToCSV({
        data: configReportDatatable.data().toArray()
      });
      if (csv == null) {
        inputError($('#configReport-form-report'),'No Reports To Create');
        return;
      }
      
      filename = args.filename || 'export.csv';
  
      if (!csv.match(/^data:text\/csv/i)) {
        csv = 'data:text/csv;charset=utf-8,' + csv;
      }
      data = encodeURI(csv);
  
      link = document.createElement('a');
      link.setAttribute('href', data);
      link.setAttribute('download', filename);
      link.click();
    }
  
    $(document).ready(function() {
      
      var configReportStartDate = moment(new Date()).format('YYYY-MM-DD');
      var configReportEndDate = moment(new Date()).format('YYYY-MM-DD');
  
      // Initialze daterangepicker and assign values to start and from dates
      function initializeConfigReportDateRangePicker () {
        $('input[id="configReport-form-daterange"]').daterangepicker({
          opens: 'bottom'
        }, function(start, end, label) {
          configReportStartDate  = start.format('YYYY-MM-DD');
          configReportEndDate    = end.format('YYYY-MM-DD');
        });
      }
  
      initializeConfigReportDateRangePicker();
      
  
      // Click Event For 'Submit Button'
      $('#configReport-form-submit').click(function() {
        clearErrors();
        
        let report = $('#configReport-form-report').val();
  
        if (report === '') {
          inputError($('#configReport-form-report'),'Select An Option');
        }
        else if (report === "VIEW REPORT") {
          
          configReportQueryConfiglog(configReportStartDate, configReportEndDate);
        }
        //@TODO if there are too many rows, does not download?
  
        else if (report === "CREATE REPORT") {
          downloadConfigReports({filename: `MAINTENANCE_REPORT_${configReportStartDate}_${configReportEndDate}.csv`});
        }
      });
  
      // Click Event For 'Clear Button'
      $('#configReport-form-clear').click(function() {
  
        let currDate = moment(new Date()).format('YYYY-MM-DD');
  
        $('.configReport-form-input').val('');
        configReportDatatable.clear().draw();
  
        $('#configReport-daterange').val('').daterangepicker("update");
        configReportStartDate = currDate;
        configReportEndDate = currDate;
  
        // reinitialize daterangepicker
        initializeConfigReportDateRangePicker();
        
        clearErrors();
      });
  
      // REPORT Change listener
      $('#configReport-form-report').change(function() {
        clearErrors();
      })	
  
    });
  
  
  
  </script>