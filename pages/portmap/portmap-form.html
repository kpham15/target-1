<div class="col-md-5">
  <form id="portmap-forms">
    <div class="row">

      <div class="col-md-5">
        <div class="form-group">
          <label>PORT</label>
          <input id="portmap-form-port" type="text" class="form-control portmap-form-input">
        </div>
      </div>

      <div class="col-md-2">
        <div class="form-group">
          <label>PORT_TYP</label>
          <select id="portmap-form-ptyp" class="form-control portmap-form-input portmap-form-select">
            <option value=""></option>
          </select>
        </div>
      </div>

      <div class="col-md-2">
        <div class="form-group">
          <label>PSTA</label>
          <select id="portmap-form-psta" class="form-control portmap-form-input portmap-form-select">
            <option value=""></option>
          </select>
        </div>
      </div>
      
      <div class="col-md-2">
        <button type="button" id="pm_findPort_btn" class="btn btn-primary" style="margin-top:25px;">View</button>
      </div>

      <div class="col-md-9">
        <div class="form-group">
          <label>FAC_ID</label>
          <input id="portmap-form-fac" type="text" class="form-control portmap-form-input">
        </div>
      </div>

      <div class="col-md-2">
        <button type="button" id="pm_findFac_btn" class="btn btn-primary" style="margin-top:25px;">View</button>
      </div>

      <div class="col-md-9">
        <div class="form-group">
          <label>CKID TN: </label>
          <input id="portmap-tn-check" type="checkbox" checked>
          <input id="portmap-form-ckid" type="text" class="form-control portmap-form-input portmap-form-ckid-num" style="display:none;">
          <input id="portmap-form-ckid-tn" type="text" class="form-control portmap-form-input portmap-form-ckid-num" placeholder="555-555-5555" data-inputmask='"mask": "999-999-9999"' data-mask="">
        </div>
      </div>

      <div class="col-md-2">
        <button type="button" id="pm_findCkid_btn" class="btn btn-primary" style="margin-top:25px;">View</button>
      </div>

      <div class="col-md-4">
        <div class="form-group">
          <label>ACTION</label>
          <select id="portmap-form-action" class="form-control">
            <option value=""></option>
            <option value="map">MAP</option>
            <option value="unmap">UNMAP</option>
          </select>
        </div>
      </div>

      <div class="col-md-2">
        <button type="button" id="portmap-form-clear" class="btn btn-primary btn-block" style="margin-top:25px;">Clear</button>
      </div>

    </div>
  </form>
</div>

<script type="text/javascript">

  var portmapNode = '';
  var portmapSlot = '';
  var portmapPnum = '';
  var portmapFacid = '';
  var portmapPortid = '';

  function queryPort(action) {
    let ckid = '';
    if ($('#portmap-tn-check').prop('checked')) {
      ckid = $('#portmap-form-ckid-tn').val();
    } else {
      ckid = $('#portmap-form-ckid').val();
    }

    $.ajax({
      type: "POST",
      url: ipcDispatch,
      data: {
        "api":      "ipcPortmap",
        "act":      action,
        "user":     user.uname,
        "node":     portmapNode,
        "slot":     portmapSlot,
        "pnum":     portmapPnum,
        "ptyp":     $('#portmap-form-ptyp').val(),
        "psta":     $('#portmap-form-psta').val(),
        "port":     $('#portmap-form-port').val().toUpperCase(),
        "fac":      $('#portmap-form-fac').val().toUpperCase(),
        "fac_id":   portmapFacid,
        "port_id":  portmapPortid,
        "ckid":     ckid
      },
      dataType: 'json'
    }).done(function(data) {
      let res = data.rows;

      console.log(res);
    });
  }

  $(document).ready(function() {

    // Initialize inputmask
    $('#portmap-form-ckid-tn').inputmask();

    // TN Checkbox Handler
    $('#portmap-tn-check').iCheck({
      checkboxClass: 'icheckbox_minimal-blue'
    });
    $('#portmap-tn-check').on('ifToggled', function() {
      $('.portmap-form-ckid-num').toggle();
    });

    // Find port button click handler
    $('#pm_findPort_btn').click(function() {
      queryPort('findPort');
    });
  });
</script>