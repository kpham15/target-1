<div class="col-md-8">
    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title">LIST OF CKTS:</h3>
        </div>
        <div style="padding: 10px;">
            <table id="svc_ckt_table" class="table table-striped table-bordered table-hover" style="width:100%;">
                <thead>
                    <tr>
                        <th>CKID</th>
                        <th>CLS</th>
                        <th>ADSR</th>
                        <th>PROT</th>
                        <th>ORDNO</th>
                        <th>MLO</th>
                        <th>DATE</th>
                    </tr>
                </thead>
            </table>
        </div>

    </div>

    <div class="box box-primary" style="display:none">
        <div class="box-header with-border">
            <h3 class="box-title">LIST OF ORDERS:</h3>
        </div>
        <div style="padding: 10px;">
            <table id="svc_ord_table" class="table table-striped table-bordered table-hover" style="width:100%;">
                <thead>
                    <tr>
                        <th>ORDNO</th>
                        <th>CKID</th>
                        <th>CONTYP</th>
                        <th>FFAC</th>
                        <th>TFAC</th>
                        <th>DATE</th>
                    </tr>
                </thead>
            </table>
        </div>

    </div>

    <div class="box box-primary" style="display:none">
        <div class="box-header with-border">
            <h3 class="box-title">LIST OF ORDERS:</h3>
        </div>
        <div style="padding: 10px;">
            <table id="svc_cktcon_table" class="table table-striped table-bordered table-hover" style="width:100%;">
                <thead>
                    <tr>
                        <th rowspan="2">ID</th>
                        <th rowspan="2">CONTYP</th>
                        <th colspan="3">FROM(X):</th>
                        <th colspan="3">TO(Y):</th>
                    </tr>
                    <tr>
                        <th>PORT</th>
                        <th>PSTA</th>
                        <th>FAC(X)</th>
                        <th>PORT</th>
                        <th>PSTA</th>
                        <th>FAC(Y)</th>
                    </tr>
                </thead>
            </table>
        </div>

    </div>
</div>

<script type="text/javascript">
    // Initialize Datatable
    var svcCktDatatable = $('#svc_ckt_table').DataTable({
        "scrollY":        "150px",
        "scrollCollapse": true,
        "data": [],
        "columns": [
            {"data":"ckid"},
            {"data":"cls"},
            {"data":"adsr"},
            {"data":"prot"},
            {"data":"ordno"},
            {"data":"mlo"},
            {
                "data":"date",
                "render": function(data) {
                    let date = moment(data).format('MM-DD-YYYY HH:mm:ss');
                    return date;
                }
            }
        ],
        "order": [[ 6, "desc" ]]
    });
  
    var svcOrdDatatable = $("#svc_ord_table").DataTable({
        "scrollY":        "150px",
        "scrollCollapse": true,
        "data" : [],
        "columns" : [
            {"data":"ordno"},
            {"data":"ckid"},
            {"data":"ctyp"},
            {"data":"ffac"},
            {"data":"tfac"},
            {"data":"date",
             "render":function(data) {
                let date = moment(data).format('MM-DD-YYYY HH:mm:ss');
                return date;
             }
            }
        ],
        "order" : [[5, "desc"]]

    })
    
    var svcCktconDatatable = $("#svc_cktcon_table").DataTable({
        "scrollY":        "150px",
        "scrollCollapse": true,
        "data" : [],
        "columns" : [
            {"data":"idx"},
            {"data":"ctyp"},
            {"data":"fport"},
            {"data":"fpsta"},
            {"data":"ffac"},
            {"data":"tport"},
            {"data":"tpsta"},
            {"data":"tfac"}
        ],
        "order" : [[0, "asc"]]

    })
    
    
    function queryCkid() {
      $.ajax({
        type: 'POST',
        url: ipcDispatch,
        data: {
          "api":    "ipcProv",
          "act":    "queryCkid",
          "user":   user.uname,
          "grp":    user.grp,
          "ugrp":   user.ugrp,
          "ckid":   $("#svc_ckid_txt").val(),
          "cls":    $("#svc_cls_sel").val(),
          "adsr":   $("#svc_adsr_sel").val(),
          "prot":   $("#svc_prot_sel").val()
        },
        dataType: 'json'
      }).done(function(data) {
        let res = data.rows;
  
        svcCktDatatable.clear().draw();
        svcCktDatatable.rows.add(res);
        svcCktDatatable.columns.adjust().draw();
      });
    }
  
    function queryOrd() {
        $.ajax({
            type: "post",
            url: ipcDispatch,
            data: {
                api: "ipcProvReport",
                act: "queryOrd",
                user: user.uname,   
                grp:  user.grp,
                ugrp: user.ugrp,
                ordno: $("#svc_ordno_txt").val(),
                mlo: $("#svc_mlo_sel").val()
            },
            dataType: 'json'
        }).done(function(data) {
            let res = data.rows;
            svcOrdDatatable.clear().draw();
            svcOrdDatatable.rows.add(res);
            svcOrdDatatable.columns.adjust().draw();
        })
    }
    
    function queryCktConByCkid(ckid) {
        $.ajax({
            type:'post',
            url:ipcDispatch,
            data: {
                api: 'ipcProv',
                act: 'queryCktconByCkid',
                user: user.uname,   
                grp:  user.grp,
                ugrp: user.ugrp,
                ckid: ckid
            },
            dataType: 'json',
        }).done(function(data){
            let res = data.rows;
            svcCktconDatatable.clear().draw();
            svcCktconDatatable.rows.add(res);
            svcCktconDatatable.columns.adjust().draw();
        })
    }
    
    $(document).ready(function() {
    
        $('#svc_findCkid_btn').click(function(e) {
            e.preventDefault();
            queryCkid();
            // clearErrors();
        });

        $("#svc_findOrd_btn").click(function(e) {
            e.preventDefault();
            queryOrd();
        })
    
        // Click events on table rows
        $(document).on('click', '#svc_ckt_table tbody tr', function() {
            let data = svcCktDatatable.row(this).data();
    
            $("#svc_cktId_num").val(data.id);
            $("#svc_ckid_txt").val(data.ckid);
            $("#svc_cls_sel").val(data.cls);
            $("#svc_adsr_sel").val(data.adsr);
            $("#svc_prot_sel").val(data.prot);
            $("#svc_ordno_txt").val(data.ordno);
            $("svc_mlo_sel").val(data.mlo);
            $("svc_date_date").val(data.date);
            $("#svc_cktconId_num").val(data.cktcon);
            
            $("svc_ffac_txt").val("");
            $("#svc_tfac_txt").val("");
            $("svc_portX_txt").val("");
            $("#svc_portY_txt").val("");
            $("#svc_ctyp_sel").val("");

            $("#svc_facSearch").hide();
            $("#svc_cktconArea").show();
            queryCktConByCkid($("#svc_ckid_txt").val());

            // Reset svc_cktconIdx_num
            $("#svc_cktconIdx_num").val("");
    
            // give selected class
            $('#svc_ckt_table tbody tr').removeClass('bg-primary');
            $(this).addClass('bg-primary');
    
            // clearErrors();
        });
        
        $(document).on('click', '#svc_ord_table tbody tr', function() {
            let data = svcCktDatatable.row(this).data();
    
            $("#svc_cktId_num").val(data.id);
            $("#svc_ordno_txt").val(data.ordno);
            $("svc_mlo_sel").val(data.mlo);
            $("#svc_ckid_txt").val(data.ckid);
            $("#svc_cls_sel").val(data.cls);
            $("#svc_adsr_sel").val(data.adsr);
            $("#svc_prot_sel").val(data.prot);
            $("#svc_ctyp_sel").val(data.ctyp);
            $("svc_ffac_txt").val(data.ffac);
            $("#svc_tfac_txt").val(data.tfac);
            $("svc_portX_txt").val("");
            $("#svc_portY_txt").val("");
            $("svc_date_date").val(data.date);
            $("#svc_facSearch").hide();

            // Reset svc_cktconIdx_num
            $("#svc_cktconIdx_num").val("");
    
            // give selected class
            $('#svc_ckt_table tbody tr').removeClass('bg-primary');
            $(this).addClass('bg-primary');
    
            // clearErrors();
        });
        

        $(document).on('click', '#svc_cktcon_table tbody tr', function() {
            let data = svcCktDatatable.row(this).data();
    
            $("#svc_cktconIdx").val(dataRow[0]).change();
            $("#svc_ctyp_sel").val(dataRow[1]);
            svc.ffac.val(dataRow[4]);
            svc.tfac.val(dataRow[7]);
            svc.portX.val(dataRow[2]);
            svc.portY.val(dataRow[5]);
            svcModal.ctyp.val(dataRow[1]).change();
            svcModal.ffac.val(dataRow[4]).change();
            svcModal.tfac.val(dataRow[7]).change();
            svcModal.discCtyp.val(dataRow[1]).change();
            svcModal.discFFac.val(dataRow[4]).change();
            svcModal.discTFac.val(dataRow[7]).change();
            svc.facSearch.hide();
            $("#svc_cktId_num").val(dataRow[0]).change();
            $("#svc_ordno_txt").val(dataRow[1]).change();
            $("svc_mlo_sel").val(dataRow[2]).change();
            $("#svc_ckid_txt").val(dataRow[3]).change();
            $("#svc_cls_sel").val(dataRow[4]).change();
            $("#svc_adsr_sel").val(dataRow[5]).change();
            $("#svc_prot_sel").val(dataRow[6]).change();
            $("#svc_ctyp_sel").val(dataRow[7]);
            $("svc_ffac_txt").val(dataRow[8]);
            $("#svc_tfac_txt").val(dataRow[9]);
            $("svc_portX_txt").val("");
            $("#svc_portY_txt").val("");
            $("svc_date_date").val(dataRow[10]).change();
            $("#svc_facSearch").hide();

            // Reset svc_cktconIdx_num
            $("#svc_cktconIdx_num").val("");
    
            // give selected class
            $('#svc_ckt_table tbody tr').removeClass('bg-primary');
            $(this).addClass('bg-primary');
    
            // clearErrors();
        });
        
    });
  </script>