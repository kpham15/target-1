<div id="report" class="tab-pane fade in" style="position: relative;">
    <h4>PORTMAP/PROVISIONING/MAINTENANCE REPORTS</h4>

    <!-- <div class="row"> -->
        <div class="col-sm-5">
            <div class="row">
                <div class="col-sm-2 modifyPadding">
                    <label for="report_user_txt">USER</label>
                    <input class="form-control modifyPadding" type="text" id="report_user_txt">
                </div>
                
                <div class="col-sm-2 modifyPadding">
                    <label for="report_function_sel">FUNCTION</label>
                    <select id="report_function_sel" class="form-control">
                        <option></option>
                        <option>PORTMAP</option>
                        <option>SVCCONN</option>
                        <option>MAINT</option>
                    </select>
                </div>
                    
                    
                <div class="col-sm-2 modifyPadding">
                    <label for="report_action_sel">ACTION</label>
                    <select class="form-control" id="report_action_sel">
                        <option></option>
                        <option>CONNECT</option>
                        <option>DISCONNECT</option>
                        <option>UPDATE_CKT</option>
                    </select>
                </div>
                    
                    
                <div class="col-sm-3 modifyPadding">
                    <label for="report_days_sel">LAST #OF DAYS</label>
                    <select id="report_days_sel" class="form-control">
                        <option></option>
                        <option>Last 1 days</option>
                        <option>Last 5 days</option>
                        <option>Last 10 days</option>
                        <option>Last 30 days</option>
                    </select>
                </div>
                    
                <div class="col-sm-2 modifyPadding">
                    <button class="btn btn-primary" id="report_view_btn">View </button>
                </div>
                <div class="col-sm-1 modifyPadding">
                    <button class="btn btn-primary" align="right" id="report_clear_btn">Clear</button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-sm-12 modifyPadding">
                    <label for="report_tbl">REPORT LIST:</label>
                </div>

                <div class="col-sm-12 modifyPadding">
                    <div class="panel panel-default">
                        <table class="table table-fixed" >
                            <thead>
                                <tr>
                                    <th style="width: 70%">Report File</th>
                                    <th style="width: 10%">Size</th>
                                    <th style="width: 20%">Links</th>
                                </tr>
                            </thead>
                            <tbody id="report_tbl" style="height:375px;">
                                    
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>                                   
        </div>
                
        <div class="col-sm-7">
            <div class="col-sm-12">
                <label for="report_txt_area">REPORT:</label>
            </div>
            <div class="col-sm-12">
                <textarea id="report_txt_area" class="form-control" style="width: 100%; min-height: 500px" readonly>
                </textarea>
            </div>
        </div>            
</div>
        
<script>
var report = {
    page:           $("#report"),
    user:           $("#report_user_txt"),
    function:       $("#report_function_sel"),
    action:         $("#report_action_sel"),
    days:           $("#report_days_sel"),
    view_btn:       $("#report_view_btn"),
    clear_btn:      $("#report_clear_btn"),
    txt_area:       $("#report_txt_area"),
    tbl: {
        body:       $("#report_tbl"),
        index:      0,
        maxIndex:   0,
    },

    tblRows:        [],
    obj:            [],
    


    start: function() {
        report.user.val('');
        report.action.val('');
        report.days.val('');
        report.txt_area.text('');
    },

    query: function(action) {
    
        $.post(ipcDispatch,
        {     
            api:        "ipcEvtlog",
            act:        action,
            user:       $("#main_currentUser").text(),
            uname:      report.user.val(),
            fnc:        report.function.val(),
            evt:        report.action.val(),
            days:       report.days.val()
        },
        function (data, status) {       
            var obj = JSON.parse(data);
            if (obj.rslt == "fail") {
                alert(obj.reason);
            }
            else {
                // write obj.detail to report text-area
                if (obj.rows.length > 0) {
                report.txt_area.text('REPORT FILE NAME: ' + obj.reportName);}
                
                for (i = 0; i < obj.rows.length; i++) {
                    report.txt_area.text(report.txt_area.text() + "\n\n" + obj.rows[i].detail);
                }

                // 
                report.tbl.index = 0;
                report.obj = obj;
                report.tblRows = obj.reportFileList;
                var len = obj.rows.length; 
                report.tbl.maxIndex = Math.ceil(len/100.0);
                report.tbl.index++;
                report.displayTable(report.tbl.index);
            } 
        });
    },

    displayTable: function(index) {   
        var startIndex = (index - 1) * 100;
        var stopIndex = index * 100;
        var len = report.tblRows.length;
    
        var url = window.location.href;

        if (len >= startIndex) {
            if (len < stopIndex) {
                stopIndex = len;
            }            
            report.tbl.body.empty();
            var a = [];
            for (var i = 0; i < stopIndex; i++) 
            {  
                a.push('<tr><td style="width: 70%">'      + report.tblRows[i].name  + '</td>');
                a.push('<td style="width: 10%">'          + report.tblRows[i].size  + '</td>');
                a.push('<td style="width: 20%"><a href="' + url + report.tblRows[i].link + report.tblRows[i].name  + '" target="_blank">View</a></td></tr>');
            }
            report.tbl.body.html(a.join(""));
            // report.indexLbl.text("From " + (startIndex + 1) + " to " + stopIndex);
        } 
    },

    clearForm: function(){
        report.user.val("");
        report.function.val("");
        report.action.val("");
        report.days.val("");
        report.txt_area.val("");

    },

}

report.function.change(function() {
    report.action.empty();
    var a = [];
    a.push('<option></option>');
    if (report.function.val() == "PORTMAP") {
        for (var i=0; i<evtlog.fnc_portmap.length; i++) {
            a.push('<option>' + evtlog.fnc_portmap[i] + '</option>');
        }
    }
    else if (report.function.val() == "SVCCONN") {
        for (var i=0; i<evtlog.fnc_svc.length; i++) {
            a.push('<option>' + evtlog.fnc_svc[i] + '</option>');
        }
    }
    else if (report.function.val() == "MAINT") {
        for (var i=0; i<evtlog.fnc_maint.length; i++) {
            a.push('<option>' + evtlog.fnc_maint[i] + '</option>');
        }
    }

    report.action.html(a.join(""));

});

report.view_btn.click(function() {
    report.query('report');
});

report.clear_btn.click(function(){
    report.clearForm();
    //report.query('query');
    //report.clearTable();

});

</script>